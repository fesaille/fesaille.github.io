



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
        <meta name="author" content="Emmmanuel Roux">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../../images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.2">
    
    
      
        <title>03 Postgres - My Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/application.adb8469c.css">
      
        <link rel="stylesheet" href="../../../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#546e7a">
      
    
    
      <script src="../../../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../../_css/extra.css">
    
      <link rel="stylesheet" href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css">
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue-grey" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#initialisation" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../../.." title="My Docs" aria-label="My Docs" class="md-header-nav__button md-logo">
          
            <img alt="logo" src="../../../../images/logo.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              My Docs
            </span>
            <span class="md-header-nav__topic">
              
                03 Postgres
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

<nav class="md-tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../../../.." class="md-tabs__link md-tabs__link--active">
        Home
      </a>
    
  </li>

      
        
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../doc/md/" class="md-tabs__link">
          doc
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../01_Python/01 - Python - CPython design/" class="md-tabs__link">
          Python
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../devops/ansible/" class="md-tabs__link">
          DevOps
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../shell/_intro/" class="md-tabs__link">
          shell
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../DB/intro/" class="md-tabs__link">
          DB
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../data/_intro/" class="md-tabs__link">
          Data
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../Viz/matplotlib/" class="md-tabs__link">
          Visualization
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../WebDev/Intro/" class="md-tabs__link">
          WebDev
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../../.." title="My Docs" class="md-nav__button md-logo">
      
        <img alt="logo" src="../../../../images/logo.svg" width="48" height="48">
      
    </a>
    My Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../aze/" title="IPYNB" class="md-nav__link">
      IPYNB
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      doc
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        doc
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../doc/md/" title="Markdown" class="md-nav__link">
      Markdown
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Python
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Python
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../01_Python/01 - Python - CPython design/" title="Intro" class="md-nav__link">
      Intro
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../Python/envs/" title="Envs" class="md-nav__link">
      Envs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../Python/IterGen/" title="Iterators, generators and coroutines" class="md-nav__link">
      Iterators, generators and coroutines
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../Linux/Ubuntu/python.md" title="Ubuntu" class="md-nav__link">
      Ubuntu
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      DevOps
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        DevOps
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../devops/ansible/" title="Ansible" class="md-nav__link">
      Ansible
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      shell
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        shell
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../shell/_intro/" title="Intro" class="md-nav__link">
      Intro
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../shell/git/" title="git" class="md-nav__link">
      git
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../shell/zsh/" title="zsh" class="md-nav__link">
      zsh
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-4" type="checkbox" id="nav-6-4">
    
    <label class="md-nav__link" for="nav-6-4">
      Ubuntu
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-4">
        Ubuntu
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../shell/Ubuntu/python/" title="Python" class="md-nav__link">
      Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../shell/Ubuntu/configuration/" title="Configuration" class="md-nav__link">
      Configuration
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      DB
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        DB
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../DB/intro/" title="intro" class="md-nav__link">
      intro
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-2" type="checkbox" id="nav-7-2">
    
    <label class="md-nav__link" for="nav-7-2">
      MongoDB
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-2">
        MongoDB
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../DB/mongoDB/_intro/" title="Intro" class="md-nav__link">
      Intro
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../DB/mongoDB/Aggregation/" title="Aggregation framework" class="md-nav__link">
      Aggregation framework
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-3" type="checkbox" id="nav-7-3">
    
    <label class="md-nav__link" for="nav-7-3">
      SQL
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-3">
        SQL
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../DB/SQL/postgres/" title="PostgreSQL" class="md-nav__link">
      PostgreSQL
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-4" type="checkbox" id="nav-7-4">
    
    <label class="md-nav__link" for="nav-7-4">
      Object store
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-4">
        Object store
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../DB/S3/_intro/" title="Intro" class="md-nav__link">
      Intro
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../data/_intro/" title="Intro" class="md-nav__link">
      Intro
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-2" type="checkbox" id="nav-8-2">
    
    <label class="md-nav__link" for="nav-8-2">
      ndarray
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-2">
        ndarray
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../ndarray/intro/" title="Intro" class="md-nav__link">
      Intro
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-3" type="checkbox" id="nav-8-3">
    
    <label class="md-nav__link" for="nav-8-3">
      Time series
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-3">
        Time series
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../data/timeseries/_intro/" title="Intro" class="md-nav__link">
      Intro
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../data/timeseries/features/" title="Features selection" class="md-nav__link">
      Features selection
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../data/timeseries/matrixprofile/" title="Matrix profile" class="md-nav__link">
      Matrix profile
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../data/windowing/" title="Windowing" class="md-nav__link">
      Windowing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-4" type="checkbox" id="nav-8-4">
    
    <label class="md-nav__link" for="nav-8-4">
      Machine Learning
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-4">
        Machine Learning
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../ml/dl/" title="Time series" class="md-nav__link">
      Time series
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Visualization
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Visualization
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../Viz/matplotlib/" title="Matplolib" class="md-nav__link">
      Matplolib
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      WebDev
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        WebDev
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../WebDev/Intro/" title="Intro" class="md-nav__link">
      Intro
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../WebDev/css/" title="CSS" class="md-nav__link">
      CSS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../WebDev/REACT/" title="REACT" class="md-nav__link">
      REACT
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <ul>
<li><a href="http://www.postgresqltutorial.com/">http://www.postgresqltutorial.com/</a></li>
<li><a href="https://www.postgresql.org/docs/11/tutorial-sql.html">https://www.postgresql.org/docs/11/tutorial-sql.html</a></li>
</ul>
<p>Postgres jupyter kernel: <a href="https://github.com/bgschiller/postgres_kernel">https://github.com/bgschiller/postgres_kernel</a></p>
<p>pgspecial must be installed for running special command postgres command in this notebook
%pip install pgspecial
Use <code>sqlmagic</code> and set sqlmagic compatible uri</p>
<div class="highlight"><pre><span></span><code><span class="o">%</span><span class="n">load_ext</span> <span class="n">sql</span>
</code></pre></div>

<pre><code>The sql extension is already loaded. To reload it, use:
  %reload_ext sql
</code></pre>
<h1 id="initialisation">Initialisation</h1>
<div class="highlight"><pre><span></span><code><span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;postgresql+psycopg2://postgres:postgres@db.postgres.app.com&quot;</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="o">%</span><span class="n">sql</span> <span class="p">{</span><span class="n">uri</span><span class="p">}</span>
</code></pre></div>

<pre><code>'Connected: postgres@None'
</code></pre>
<p>SQL for table deletion and creation</p>
<div class="highlight"><pre><span></span><code><span class="o">%</span><span class="n">sql</span> <span class="n">select</span> <span class="n">current_database</span><span class="p">()</span>
</code></pre></div>

<pre><code> * postgresql+psycopg2://postgres:***@db.postgres.app.com
1 rows affected.
</code></pre>
<table>
    <tr>
        <th>current_database</th>
    </tr>
    <tr>
        <td>postgres</td>
    </tr>
</table>

<div class="highlight"><pre><span></span><code><span class="o">%%</span><span class="n">sql</span>

<span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">pg_tables</span>
<span class="n">WHERE</span> <span class="n">schemaname</span> <span class="n">NOT</span> <span class="n">IN</span> <span class="p">(</span><span class="s1">&#39;pg_catalog&#39;</span><span class="p">,</span> <span class="s1">&#39;information_schema&#39;</span><span class="p">);</span>
</code></pre></div>

<pre><code> * postgresql+psycopg2://postgres:***@db.postgres.app.com
1 rows affected.
</code></pre>
<table>
    <tr>
        <th>schemaname</th>
        <th>tablename</th>
        <th>tableowner</th>
        <th>tablespace</th>
        <th>hasindexes</th>
        <th>hasrules</th>
        <th>hastriggers</th>
        <th>rowsecurity</th>
    </tr>
    <tr>
        <td>public</td>
        <td>country</td>
        <td>postgres</td>
        <td>None</td>
        <td>True</td>
        <td>False</td>
        <td>False</td>
        <td>False</td>
    </tr>
</table>

<div class="highlight"><pre><span></span><code><span class="o">%%</span><span class="n">sql</span>

<span class="n">DROP</span> <span class="n">TABLE</span> <span class="n">IF</span> <span class="n">EXISTS</span> <span class="n">Person</span><span class="p">;</span>
<span class="n">DROP</span> <span class="n">TABLE</span> <span class="n">IF</span> <span class="n">EXISTS</span> <span class="n">Country</span><span class="p">;</span>
</code></pre></div>

<pre><code> * postgresql+psycopg2://postgres:***@db.postgres.app.com
Done.
Done.





[]
</code></pre>
<h1 id="create-table">Create table</h1>
<p><strong>Primary key</strong>, auto-increment (see <a href="https://chartio.com/resources/tutorials/how-to-define-an-auto-increment-primary-key-in-postgresql/">post</a>):
- usage of the SERIAL or BIGSERIAL data types when CREATING a new table.
- creating a custom SEQUENCE</p>
<div class="highlight"><pre><span></span><code><span class="o">%%</span><span class="n">sql</span>

<span class="n">CREATE</span> <span class="n">TABLE</span> <span class="n">Country</span> <span class="p">(</span>
    <span class="n">country_id</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="n">PRIMARY</span> <span class="n">KEY</span><span class="p">,</span>
    <span class="n">country_name</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
<span class="p">);</span>

<span class="n">CREATE</span> <span class="n">TABLE</span> <span class="n">Person</span> <span class="p">(</span>
    <span class="n">person_id</span> <span class="n">SERIAL</span> <span class="n">PRIMARY</span> <span class="n">KEY</span><span class="p">,</span>
    <span class="n">person_first</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">person_last</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">country_id</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span>
    <span class="n">FOREIGN</span> <span class="n">KEY</span> <span class="p">(</span><span class="n">country_id</span><span class="p">)</span> <span class="n">REFERENCES</span> <span class="n">Country</span><span class="p">(</span><span class="n">country_id</span><span class="p">),</span>
    <span class="n">CON</span>
<span class="p">);</span>
</code></pre></div>

<pre><code> * postgresql+psycopg2://postgres:***@db.postgres.app.com
Done.
(psycopg2.errors.SyntaxError) syntax error at or near ")"
LINE 8: );
        ^

[SQL: CREATE TABLE Person (
    person_id SERIAL PRIMARY KEY,
    person_first varchar(255),
    person_last varchar(255),
    country_id varchar(2) NOT NULL,
    FOREIGN KEY (country_id) REFERENCES Country(country_id),
    CON
);]
(Background on this error at: http://sqlalche.me/e/f405)
</code></pre>
<p>View table list, either with postgres special command <code>\dt</code> or from <em>pg_catalog</em></p>
<div class="highlight"><pre><span></span><code><span class="o">%%</span><span class="n">sql</span>
\<span class="n">dt</span>
</code></pre></div>

<pre><code> * postgresql+psycopg2://postgres:***@db.postgres.app.com
1 rows affected.
</code></pre>
<table>
    <tr>
        <th>Schema</th>
        <th>Name</th>
        <th>Type</th>
        <th>Owner</th>
    </tr>
    <tr>
        <td>public</td>
        <td>country</td>
        <td>table</td>
        <td>postgres</td>
    </tr>
</table>

<div class="highlight"><pre><span></span><code><span class="o">%%</span><span class="n">sql</span>
<span class="n">DESCRIBE</span> <span class="n">accounts</span><span class="p">;</span>
</code></pre></div>

<pre><code> * postgresql+psycopg2://postgres:***@db.postgres.app.com
(psycopg2.errors.SyntaxError) syntax error at or near "DESCRIBE"
LINE 1: DESCRIBE accounts;
        ^

[SQL: DESCRIBE accounts;]
(Background on this error at: http://sqlalche.me/e/f405)
</code></pre>
<div class="highlight"><pre><span></span><code><span class="o">%%</span><span class="n">sql</span>
<span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">pg_catalog</span><span class="o">.</span><span class="n">pg_tables</span>
<span class="n">WHERE</span> <span class="n">schemaname</span> <span class="o">!=</span> <span class="s1">&#39;pg_catalog&#39;</span>
<span class="n">AND</span> <span class="n">schemaname</span> <span class="o">!=</span> <span class="s1">&#39;information_schema&#39;</span><span class="p">;</span>
</code></pre></div>

<pre><code> * postgresql+psycopg2://postgres:***@db.postgres.app.com
1 rows affected.
</code></pre>
<table>
    <tr>
        <th>schemaname</th>
        <th>tablename</th>
        <th>tableowner</th>
        <th>tablespace</th>
        <th>hasindexes</th>
        <th>hasrules</th>
        <th>hastriggers</th>
        <th>rowsecurity</th>
    </tr>
    <tr>
        <td>public</td>
        <td>country</td>
        <td>postgres</td>
        <td>None</td>
        <td>True</td>
        <td>False</td>
        <td>False</td>
        <td>False</td>
    </tr>
</table>

<h1 id="insert-rows">Insert rows</h1>
<div class="highlight"><pre><span></span><code><span class="o">%%</span><span class="n">sql</span>

<span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">Country</span><span class="p">(</span><span class="n">country_id</span><span class="p">,</span> <span class="n">country_name</span><span class="p">)</span> 
<span class="n">VALUES</span> 
<span class="p">(</span><span class="s1">&#39;FR&#39;</span><span class="p">,</span> <span class="s1">&#39;France&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;CU&#39;</span><span class="p">,</span> <span class="s1">&#39;CUBA&#39;</span><span class="p">);</span>
</code></pre></div>

<pre><code> * postgresql+psycopg2://postgres:***@db.postgres.app.com
2 rows affected.





[]
</code></pre>
<p>The <code>pg_relation_size()</code> function returns the size of the table only, not included indexes or additional objects.</p>
<div class="highlight"><pre><span></span><code><span class="o">%%</span><span class="n">sql</span>

<span class="n">SELECT</span> <span class="n">pg_size_pretty</span><span class="p">(</span><span class="n">pg_relation_size</span><span class="p">(</span><span class="s1">&#39;Country&#39;</span><span class="p">));</span>
</code></pre></div>

<pre><code> * postgresql+psycopg2://postgres:***@db.postgres.app.com
1 rows affected.
</code></pre>
<table>
    <tr>
        <th>pg_size_pretty</th>
    </tr>
    <tr>
        <td>8192 bytes</td>
    </tr>
</table>

<div class="highlight"><pre><span></span><code><span class="o">%%</span><span class="n">sql</span>

<span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">Person</span> <span class="p">(</span><span class="n">person_first</span><span class="p">,</span> <span class="n">person_last</span><span class="p">,</span> <span class="n">country_id</span><span class="p">)</span> 
<span class="n">VALUES</span> 
<span class="p">(</span><span class="s1">&#39;Napolean&#39;</span><span class="p">,</span> <span class="s1">&#39;Bonaparte&#39;</span><span class="p">,</span> <span class="s1">&#39;FR&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;Luis&#39;</span><span class="p">,</span><span class="s1">&#39;Alvarez&#39;</span><span class="p">,</span> <span class="s1">&#39;CU&#39;</span><span class="p">);</span>
</code></pre></div>

<pre><code> * postgresql+psycopg2://postgres:***@db.postgres.app.com
(psycopg2.errors.UndefinedTable) relation "person" does not exist
LINE 1: INSERT INTO Person (person_first, person_last, country_id) 
                    ^

[SQL: INSERT INTO Person (person_first, person_last, country_id) 
VALUES 
('Napolean', 'Bonaparte', 'FR'),
('Luis','Alvarez', 'CU');]
(Background on this error at: http://sqlalche.me/e/f405)
</code></pre>
<p>Accessing the RDBMS dictionary.</p>
<div class="highlight"><pre><span></span><code><span class="o">%%</span><span class="n">sql</span>

<span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">pg_catalog</span><span class="o">.</span><span class="n">pg_tables</span>
<span class="n">WHERE</span> <span class="n">schemaname</span> <span class="o">!=</span> <span class="s1">&#39;pg_catalog&#39;</span><span class="p">;</span>
</code></pre></div>

<pre><code> * postgresql+psycopg2://postgres:***@db.postgres.app.com
8 rows affected.
</code></pre>
<table>
    <tr>
        <th>schemaname</th>
        <th>tablename</th>
        <th>tableowner</th>
        <th>tablespace</th>
        <th>hasindexes</th>
        <th>hasrules</th>
        <th>hastriggers</th>
        <th>rowsecurity</th>
    </tr>
    <tr>
        <td>public</td>
        <td>country</td>
        <td>postgres</td>
        <td>None</td>
        <td>True</td>
        <td>False</td>
        <td>False</td>
        <td>False</td>
    </tr>
    <tr>
        <td>information_schema</td>
        <td>sql_features</td>
        <td>postgres</td>
        <td>None</td>
        <td>False</td>
        <td>False</td>
        <td>False</td>
        <td>False</td>
    </tr>
    <tr>
        <td>information_schema</td>
        <td>sql_implementation_info</td>
        <td>postgres</td>
        <td>None</td>
        <td>False</td>
        <td>False</td>
        <td>False</td>
        <td>False</td>
    </tr>
    <tr>
        <td>information_schema</td>
        <td>sql_languages</td>
        <td>postgres</td>
        <td>None</td>
        <td>False</td>
        <td>False</td>
        <td>False</td>
        <td>False</td>
    </tr>
    <tr>
        <td>information_schema</td>
        <td>sql_packages</td>
        <td>postgres</td>
        <td>None</td>
        <td>False</td>
        <td>False</td>
        <td>False</td>
        <td>False</td>
    </tr>
    <tr>
        <td>information_schema</td>
        <td>sql_parts</td>
        <td>postgres</td>
        <td>None</td>
        <td>False</td>
        <td>False</td>
        <td>False</td>
        <td>False</td>
    </tr>
    <tr>
        <td>information_schema</td>
        <td>sql_sizing</td>
        <td>postgres</td>
        <td>None</td>
        <td>False</td>
        <td>False</td>
        <td>False</td>
        <td>False</td>
    </tr>
    <tr>
        <td>information_schema</td>
        <td>sql_sizing_profiles</td>
        <td>postgres</td>
        <td>None</td>
        <td>False</td>
        <td>False</td>
        <td>False</td>
        <td>False</td>
    </tr>
</table>

<div class="highlight"><pre><span></span><code><span class="o">%%</span><span class="n">sql</span>

<span class="n">SELECT</span> <span class="n">sql</span> <span class="n">FROM</span> <span class="n">postgres</span> 
<span class="n">WHERE</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Person&#39;</span><span class="p">;</span>
</code></pre></div>

<pre><code> * postgresql+psycopg2://postgres:***@db.postgres.app.com
(psycopg2.errors.UndefinedTable) relation "postgres" does not exist
LINE 1: SELECT sql FROM postgres 
                        ^

[SQL: SELECT sql FROM postgres 
WHERE name='Person';]
(Background on this error at: http://sqlalche.me/e/f405)
</code></pre>
<p>SQL as a Query Language.</p>
<div class="highlight"><pre><span></span><code><span class="o">%%</span><span class="n">sql</span>

<span class="n">SELECT</span> <span class="n">person_first</span> <span class="k">as</span> <span class="n">first</span><span class="p">,</span> <span class="n">person_last</span> <span class="n">AS</span> <span class="n">last</span><span class="p">,</span> <span class="n">country_name</span> <span class="n">AS</span> <span class="n">nationality</span>
<span class="n">FROM</span> <span class="n">Person</span> 
<span class="n">INNER</span> <span class="n">JOIN</span> <span class="n">country</span> 
<span class="n">ON</span> <span class="n">Person</span><span class="o">.</span><span class="n">country_id</span> <span class="o">=</span> <span class="n">Country</span><span class="o">.</span><span class="n">country_id</span><span class="p">;</span>
</code></pre></div>

<pre><code> * postgresql+psycopg2://postgres:***@db.postgres.app.com
(psycopg2.errors.UndefinedTable) relation "person" does not exist
LINE 2: FROM Person 
             ^

[SQL: SELECT person_first as first, person_last AS last, country_name AS nationality
FROM Person 
INNER JOIN country 
ON Person.country_id = Country.country_id;]
(Background on this error at: http://sqlalche.me/e/f405)
</code></pre>
<p>Visualizing the entitry-relationship diagram (ERd).</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">ibis</span>
</code></pre></div>

<p><div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">eralchemy</span>
</code></pre></div>
import os
from eralchemy import render_er</p>
<p>if not os.path.exists('erd<em>from</em>sqlalchemy.png'):
    render<em>er(uri, 'erd</em>from_sqlalchemy.png')
<img alt="" src="../erd_from_sqlalchemy.png" /></p>
<h2 id="homework-walk-through">Homework walk-through</h2>
<p>Convert the flat file data in <code>data/flat.csv</code> into a well-structured relational database in SQLite3 stored as <code>data/faculty.db</code>. Note - salary information is confidential and should be kept in a separate table from other personal data.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">flat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/flat.csv&#39;</span><span class="p">,</span> <span class="n">keep_default_na</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">flat</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>gender</th>
      <th>age</th>
      <th>height</th>
      <th>weight</th>
      <th>salary</th>
      <th>nationality</th>
      <th>code</th>
      <th>country</th>
      <th>language1</th>
      <th>language2</th>
      <th>language3</th>
      <th>first</th>
      <th>last</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>915</td>
      <td>Lynwood Pope</td>
      <td>Male</td>
      <td>20</td>
      <td>1.51</td>
      <td>40</td>
      <td>88000</td>
      <td>Jordanian</td>
      <td>JO</td>
      <td>Jordan</td>
      <td>ASP</td>
      <td>Scala</td>
      <td></td>
      <td>Lynwood</td>
      <td>Pope</td>
    </tr>
    <tr>
      <td>1</td>
      <td>Aaron Kirby</td>
      <td>Male</td>
      <td>59</td>
      <td>1.69</td>
      <td>43</td>
      <td>80000</td>
      <td>Spanish</td>
      <td>SP</td>
      <td>Spain</td>
      <td>Falcon</td>
      <td>haXe</td>
      <td>GNU Octave</td>
      <td>Aaron</td>
      <td>Kirby</td>
    </tr>
    <tr>
      <td>239</td>
      <td>Clarita Carver</td>
      <td>Female</td>
      <td>35</td>
      <td>1.66</td>
      <td>71</td>
      <td>84000</td>
      <td>Finnish</td>
      <td>FI</td>
      <td>Finland</td>
      <td>Prolog</td>
      <td>Erlang</td>
      <td>Smalltalk</td>
      <td>Clarita</td>
      <td>Carver</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><code><span class="o">%%</span><span class="n">sql</span>

<span class="n">USE</span> <span class="n">faculty</span><span class="p">;</span>
</code></pre></div>

<pre><code> * postgresql+psycopg2://postgres:***@db.postgres.app.com
(psycopg2.errors.SyntaxError) syntax error at or near "USE"
LINE 1: USE faculty;
        ^

[SQL: USE faculty;]
(Background on this error at: http://sqlalche.me/e/f405)
</code></pre>
<div class="highlight"><pre><span></span><code><span class="o">%%</span><span class="n">sql</span>

<span class="n">DROP</span> <span class="n">TABLE</span> <span class="n">IF</span> <span class="n">EXISTS</span> <span class="n">Person</span><span class="p">;</span>
<span class="n">DROP</span> <span class="n">TABLE</span> <span class="n">IF</span> <span class="n">EXISTS</span> <span class="n">Country</span><span class="p">;</span>

<span class="n">CREATE</span> <span class="n">TABLE</span> <span class="n">Country</span> <span class="p">(</span>
    <span class="n">country_id</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="n">PRIMARY</span> <span class="n">KEY</span><span class="p">,</span>
    <span class="n">country_name</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
<span class="p">);</span>

<span class="n">CREATE</span> <span class="n">TABLE</span> <span class="n">Person</span> <span class="p">(</span>
    <span class="n">person_id</span> <span class="n">SERIAL</span> <span class="n">PRIMARY</span> <span class="n">KEY</span><span class="p">,</span>
    <span class="n">name</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">age</span> <span class="n">INTEGER</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span>
    <span class="n">country_id</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span>
      <span class="n">FOREIGN</span> <span class="n">KEY</span> <span class="p">(</span><span class="n">country_id</span><span class="p">)</span> <span class="n">REFERENCES</span> <span class="n">Country</span><span class="p">(</span><span class="n">country_id</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>

<pre><code> * postgresql+psycopg2://postgres:***@db.postgres.app.com/postgres
Done.
Done.
Done.
Done.





[]
</code></pre>
<div class="highlight"><pre><span></span><code><span class="o">%%</span><span class="n">sql</span>

<span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">Country</span><span class="p">(</span><span class="n">country_id</span><span class="p">,</span> <span class="n">country_name</span><span class="p">)</span> 
<span class="n">VALUES</span> <span class="p">(</span><span class="s1">&#39;FR&#39;</span><span class="p">,</span> <span class="s1">&#39;France&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;CU&#39;</span><span class="p">,</span> <span class="s1">&#39;CUBA&#39;</span><span class="p">);</span>
</code></pre></div>

<pre><code> * postgresql+psycopg2://postgres:***@db.postgres.app.com/postgres
2 rows affected.





[]
</code></pre>
<div class="highlight"><pre><span></span><code><span class="o">%%</span><span class="n">sql</span>
<span class="n">DELETE</span> <span class="n">FROM</span> <span class="n">Country</span>
</code></pre></div>

<pre><code> * postgresql+psycopg2://postgres:***@db.postgres.app.com/postgres
2 rows affected.





[]
</code></pre>
<div class="highlight"><pre><span></span><code><span class="o">%%</span><span class="n">sql</span>
<span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">Country</span>
</code></pre></div>

<pre><code> * postgresql+psycopg2://postgres:***@db.postgres.app.com/postgres
0 rows affected.
</code></pre>
<table>
    <tr>
        <th>country_id</th>
        <th>country_name</th>
    </tr>
</table>

<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">conn</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">flat</span><span class="o">.</span><span class="n">columns</span>
</code></pre></div>

<pre><code>Index(['name', 'gender', 'age', 'height', 'weight', 'salary', 'nationality',
       'code', 'country', 'language1', 'language2', 'language3', 'first',
       'last'],
      dtype='object')
</code></pre>
<div class="highlight"><pre><span></span><code><span class="n">flat</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">mapper</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="s1">&#39;country_id&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;country&#39;</span><span class="p">:</span> <span class="s1">&#39;country_name&#39;</span><span class="p">},</span>
           <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">country</span> <span class="o">=</span> <span class="n">flat</span><span class="p">[[</span><span class="s1">&#39;country_id&#39;</span><span class="p">,</span> <span class="s1">&#39;country_name&#39;</span><span class="p">]]</span>
</code></pre></div>

<pre><code>---------------------------------------------------------------------------

KeyError                                  Traceback (most recent call last)

&lt;ipython-input-31-f9749b54edd5&gt; in &lt;module&gt;
----&gt; 1 country = flat[['country_id', 'country_name']]


/opt/conda/lib/python3.7/site-packages/pandas/core/frame.py in __getitem__(self, key)
   2932                 key = list(key)
   2933             indexer = self.loc._convert_to_indexer(key, axis=1,
-&gt; 2934                                                    raise_missing=True)
   2935 
   2936         # take() does not accept boolean indexers


/opt/conda/lib/python3.7/site-packages/pandas/core/indexing.py in _convert_to_indexer(self, obj, axis, is_setter, raise_missing)
   1352                 kwargs = {'raise_missing': True if is_setter else
   1353                           raise_missing}
-&gt; 1354                 return self._get_listlike_indexer(obj, axis, **kwargs)[1]
   1355         else:
   1356             try:


/opt/conda/lib/python3.7/site-packages/pandas/core/indexing.py in _get_listlike_indexer(self, key, axis, raise_missing)
   1159         self._validate_read_indexer(keyarr, indexer,
   1160                                     o._get_axis_number(axis),
-&gt; 1161                                     raise_missing=raise_missing)
   1162         return keyarr, indexer
   1163


/opt/conda/lib/python3.7/site-packages/pandas/core/indexing.py in _validate_read_indexer(self, key, indexer, axis, raise_missing)
   1244                 raise KeyError(
   1245                     u"None of [{key}] are in the [{axis}]".format(
-&gt; 1246                         key=key, axis=self.obj._get_axis_name(axis)))
   1247 
   1248             # We (temporarily) allow for some missing keys with .loc, except in


KeyError: "None of [Index(['country_id', 'country_name'], dtype='object')] are in the [columns]"
</code></pre>
<div class="highlight"><pre><span></span><code><span class="n">country</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;country_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s1">&#39;Country&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s1">&#39;append&#39;</span><span class="p">)</span>
</code></pre></div>

<pre><code>---------------------------------------------------------------------------

UndefinedColumn                           Traceback (most recent call last)

/opt/conda/lib/python3.7/site-packages/sqlalchemy/engine/base.py in _execute_context(self, dialect, constructor, statement, parameters, *args)
   1223                     self.dialect.do_executemany(
-&gt; 1224                         cursor, statement, parameters, context
   1225                     )


/opt/conda/lib/python3.7/site-packages/sqlalchemy/dialects/postgresql/psycopg2.py in do_executemany(self, cursor, statement, parameters, context)
    751         else:
--&gt; 752             cursor.executemany(statement, parameters)
    753


UndefinedColumn: column "country_id" of relation "Country" does not exist
LINE 1: INSERT INTO "Country" (country_id, country_name) VALUES ('GB...
                               ^



The above exception was the direct cause of the following exception:


ProgrammingError                          Traceback (most recent call last)

&lt;ipython-input-103-42976342ffd9&gt; in &lt;module&gt;
----&gt; 1 country.set_index('country_id').to_sql('Country', engine, if_exists='append')


/opt/conda/lib/python3.7/site-packages/pandas/core/generic.py in to_sql(self, name, con, schema, if_exists, index, index_label, chunksize, dtype, method)
   2529         sql.to_sql(self, name, con, schema=schema, if_exists=if_exists,
   2530                    index=index, index_label=index_label, chunksize=chunksize,
-&gt; 2531                    dtype=dtype, method=method)
   2532 
   2533     def to_pickle(self, path, compression='infer',


/opt/conda/lib/python3.7/site-packages/pandas/io/sql.py in to_sql(frame, name, con, schema, if_exists, index, index_label, chunksize, dtype, method)
    458     pandas_sql.to_sql(frame, name, if_exists=if_exists, index=index,
    459                       index_label=index_label, schema=schema,
--&gt; 460                       chunksize=chunksize, dtype=dtype, method=method)
    461 
    462


/opt/conda/lib/python3.7/site-packages/pandas/io/sql.py in to_sql(self, frame, name, if_exists, index, index_label, schema, chunksize, dtype, method)
   1172                          schema=schema, dtype=dtype)
   1173         table.create()
-&gt; 1174         table.insert(chunksize, method=method)
   1175         if (not name.isdigit() and not name.islower()):
   1176             # check for potentially case sensitivity issues (GH7815)


/opt/conda/lib/python3.7/site-packages/pandas/io/sql.py in insert(self, chunksize, method)
    684 
    685                 chunk_iter = zip(*[arr[start_i:end_i] for arr in data_list])
--&gt; 686                 exec_insert(conn, keys, chunk_iter)
    687 
    688     def _query_iterator(self, result, chunksize, columns, coerce_float=True,


/opt/conda/lib/python3.7/site-packages/pandas/io/sql.py in _execute_insert(self, conn, keys, data_iter)
    597         """
    598         data = [dict(zip(keys, row)) for row in data_iter]
--&gt; 599         conn.execute(self.table.insert(), data)
    600 
    601     def _execute_insert_multi(self, conn, keys, data_iter):


/opt/conda/lib/python3.7/site-packages/sqlalchemy/engine/base.py in execute(self, object_, *multiparams, **params)
    986             raise exc.ObjectNotExecutableError(object_)
    987         else:
--&gt; 988             return meth(self, multiparams, params)
    989 
    990     def _execute_function(self, func, multiparams, params):


/opt/conda/lib/python3.7/site-packages/sqlalchemy/sql/elements.py in _execute_on_connection(self, connection, multiparams, params)
    285     def _execute_on_connection(self, connection, multiparams, params):
    286         if self.supports_execution:
--&gt; 287             return connection._execute_clauseelement(self, multiparams, params)
    288         else:
    289             raise exc.ObjectNotExecutableError(self)


/opt/conda/lib/python3.7/site-packages/sqlalchemy/engine/base.py in _execute_clauseelement(self, elem, multiparams, params)
   1105             distilled_params,
   1106             compiled_sql,
-&gt; 1107             distilled_params,
   1108         )
   1109         if self._has_events or self.engine._has_events:


/opt/conda/lib/python3.7/site-packages/sqlalchemy/engine/base.py in _execute_context(self, dialect, constructor, statement, parameters, *args)
   1246         except BaseException as e:
   1247             self._handle_dbapi_exception(
-&gt; 1248                 e, statement, parameters, cursor, context
   1249             )
   1250


/opt/conda/lib/python3.7/site-packages/sqlalchemy/engine/base.py in _handle_dbapi_exception(self, e, statement, parameters, cursor, context)
   1464                 util.raise_from_cause(newraise, exc_info)
   1465             elif should_wrap:
-&gt; 1466                 util.raise_from_cause(sqlalchemy_exception, exc_info)
   1467             else:
   1468                 util.reraise(*exc_info)


/opt/conda/lib/python3.7/site-packages/sqlalchemy/util/compat.py in raise_from_cause(exception, exc_info)
    381     exc_type, exc_value, exc_tb = exc_info
    382     cause = exc_value if exc_value is not exception else None
--&gt; 383     reraise(type(exception), exception, tb=exc_tb, cause=cause)
    384 
    385


/opt/conda/lib/python3.7/site-packages/sqlalchemy/util/compat.py in reraise(tp, value, tb, cause)
    126             value.__cause__ = cause
    127         if value.__traceback__ is not tb:
--&gt; 128             raise value.with_traceback(tb)
    129         raise value
    130


/opt/conda/lib/python3.7/site-packages/sqlalchemy/engine/base.py in _execute_context(self, dialect, constructor, statement, parameters, *args)
   1222                 if not evt_handled:
   1223                     self.dialect.do_executemany(
-&gt; 1224                         cursor, statement, parameters, context
   1225                     )
   1226             elif not parameters and context.no_parameters:


/opt/conda/lib/python3.7/site-packages/sqlalchemy/dialects/postgresql/psycopg2.py in do_executemany(self, cursor, statement, parameters, context)
    750             extras.execute_batch(cursor, statement, parameters)
    751         else:
--&gt; 752             cursor.executemany(statement, parameters)
    753 
    754     @util.memoized_instancemethod


ProgrammingError: (psycopg2.errors.UndefinedColumn) column "country_id" of relation "Country" does not exist
LINE 1: INSERT INTO "Country" (country_id, country_name) VALUES ('GB...
                               ^

[SQL: INSERT INTO "Country" (country_id, country_name) VALUES (%(country_id)s, %(country_name)s)]
[parameters: ({'country_id': 'GB', 'country_name': 'United Kingdom'}, {'country_id': 'SP', 'country_name': 'Spain'}, {'country_id': 'IT', 'country_name': 'Italy'}, {'country_id': 'IT', 'country_name': 'Italy'}, {'country_id': 'UY', 'country_name': 'Uruguay'}, {'country_id': 'CM', 'country_name': 'Cambodia'}, {'country_id': 'CM', 'country_name': 'Cameroon'}, {'country_id': 'BE', 'country_name': 'Belgium'}  ... displaying 10 of 1523 total bound parameter sets ...  {'country_id': 'ET', 'country_name': 'Ethiopia'}, {'country_id': 'VE', 'country_name': 'Venezuela'})]
(Background on this error at: http://sqlalche.me/e/f405)
</code></pre>
<h1 id="sql">%%sql</h1>
<p>SELECT * FROM Country</p>
<div class="highlight"><pre><span></span><code><span class="n">flat</span><span class="o">.</span><span class="n">to_sql</span><span class="err">?</span>
</code></pre></div>

<pre><code>[0;31mSignature:[0m
[0mflat[0m[0;34m.[0m[0mto_sql[0m[0;34m([0m[0;34m[0m
[0;34m[0m    [0mname[0m[0;34m,[0m[0;34m[0m
[0;34m[0m    [0mcon[0m[0;34m,[0m[0;34m[0m
[0;34m[0m    [0mschema[0m[0;34m=[0m[0;32mNone[0m[0;34m,[0m[0;34m[0m
[0;34m[0m    [0mif_exists[0m[0;34m=[0m[0;34m'fail'[0m[0;34m,[0m[0;34m[0m
[0;34m[0m    [0mindex[0m[0;34m=[0m[0;32mTrue[0m[0;34m,[0m[0;34m[0m
[0;34m[0m    [0mindex_label[0m[0;34m=[0m[0;32mNone[0m[0;34m,[0m[0;34m[0m
[0;34m[0m    [0mchunksize[0m[0;34m=[0m[0;32mNone[0m[0;34m,[0m[0;34m[0m
[0;34m[0m    [0mdtype[0m[0;34m=[0m[0;32mNone[0m[0;34m,[0m[0;34m[0m
[0;34m[0m    [0mmethod[0m[0;34m=[0m[0;32mNone[0m[0;34m,[0m[0;34m[0m
[0;34m[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[0;31mDocstring:[0m
Write records stored in a DataFrame to a SQL database.

Databases supported by SQLAlchemy [1]_ are supported. Tables can be
newly created, appended to, or overwritten.

Parameters
----------
name : string
    Name of SQL table.
con : sqlalchemy.engine.Engine or sqlite3.Connection
    Using SQLAlchemy makes it possible to use any DB supported by that
    library. Legacy support is provided for sqlite3.Connection objects.
schema : string, optional
    Specify the schema (if database flavor supports this). If None, use
    default schema.
if_exists : {'fail', 'replace', 'append'}, default 'fail'
    How to behave if the table already exists.

    * fail: Raise a ValueError.
    * replace: Drop the table before inserting new values.
    * append: Insert new values to the existing table.

index : bool, default True
    Write DataFrame index as a column. Uses `index_label` as the column
    name in the table.
index_label : string or sequence, default None
    Column label for index column(s). If None is given (default) and
    `index` is True, then the index names are used.
    A sequence should be given if the DataFrame uses MultiIndex.
chunksize : int, optional
    Rows will be written in batches of this size at a time. By default,
    all rows will be written at once.
dtype : dict, optional
    Specifying the datatype for columns. The keys should be the column
    names and the values should be the SQLAlchemy types or strings for
    the sqlite3 legacy mode.
method : {None, 'multi', callable}, default None
    Controls the SQL insertion clause used:

    * None : Uses standard SQL ``INSERT`` clause (one per row).
    * 'multi': Pass multiple values in a single ``INSERT`` clause.
    * callable with signature ``(pd_table, conn, keys, data_iter)``.

    Details and a sample callable implementation can be found in the
    section :ref:`insert method &lt;io.sql.method&gt;`.

    .. versionadded:: 0.24.0

Raises
------
ValueError
    When the table already exists and `if_exists` is 'fail' (the
    default).

See Also
--------
read_sql : Read a DataFrame from a table.

Notes
-----
Timezone aware datetime columns will be written as
``Timestamp with timezone`` type with SQLAlchemy if supported by the
database. Otherwise, the datetimes will be stored as timezone unaware
timestamps local to the original timezone.

.. versionadded:: 0.24.0

References
----------
.. [1] http://docs.sqlalchemy.org
.. [2] https://www.python.org/dev/peps/pep-0249/

Examples
--------

Create an in-memory SQLite database.

&gt;&gt;&gt; from sqlalchemy import create_engine
&gt;&gt;&gt; engine = create_engine('sqlite://', echo=False)

Create a table from scratch with 3 rows.

&gt;&gt;&gt; df = pd.DataFrame({'name' : ['User 1', 'User 2', 'User 3']})
&gt;&gt;&gt; df
     name
0  User 1
1  User 2
2  User 3

&gt;&gt;&gt; df.to_sql('users', con=engine)
&gt;&gt;&gt; engine.execute("SELECT * FROM users").fetchall()
[(0, 'User 1'), (1, 'User 2'), (2, 'User 3')]

&gt;&gt;&gt; df1 = pd.DataFrame({'name' : ['User 4', 'User 5']})
&gt;&gt;&gt; df1.to_sql('users', con=engine, if_exists='append')
&gt;&gt;&gt; engine.execute("SELECT * FROM users").fetchall()
[(0, 'User 1'), (1, 'User 2'), (2, 'User 3'),
 (0, 'User 4'), (1, 'User 5')]

Overwrite the table with just ``df1``.

&gt;&gt;&gt; df1.to_sql('users', con=engine, if_exists='replace',
...            index_label='id')
&gt;&gt;&gt; engine.execute("SELECT * FROM users").fetchall()
[(0, 'User 4'), (1, 'User 5')]

Specify the dtype (especially useful for integers with missing values).
Notice that while pandas is forced to store the data as floating point,
the database supports nullable integers. When fetching the data with
Python, we get back integer scalars.

&gt;&gt;&gt; df = pd.DataFrame({"A": [1, None, 2]})
&gt;&gt;&gt; df
     A
0  1.0
1  NaN
2  2.0

&gt;&gt;&gt; from sqlalchemy.types import Integer
&gt;&gt;&gt; df.to_sql('integers', con=engine, index=False,
...           dtype={"A": Integer()})

&gt;&gt;&gt; engine.execute("SELECT * FROM integers").fetchall()
[(1,), (None,), (2,)]
[0;31mFile:[0m      /opt/conda/lib/python3.7/site-packages/pandas/core/generic.py
[0;31mType:[0m      method
</code></pre>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">asyncio</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">coro</span><span class="p">(</span><span class="nb">int</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;running </span><span class="si">{int}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;continuing </span><span class="si">{int}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">int</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">coro</span><span class="p">)</span>
</code></pre></div>

<pre><code>---------------------------------------------------------------------------

RuntimeError                              Traceback (most recent call last)

&lt;ipython-input-109-550412da50e5&gt; in &lt;module&gt;
----&gt; 1 asyncio.run(coro)


/opt/conda/lib/python3.7/asyncio/runners.py in run(main, debug)
     32     if events._get_running_loop() is not None:
     33         raise RuntimeError(
---&gt; 34             "asyncio.run() cannot be called from a running event loop")
     35 
     36     if not coroutines.iscoroutine(main):


RuntimeError: asyncio.run() cannot be called from a running event loop
</code></pre>
<div class="highlight"><pre><span></span><code>
</code></pre></div>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  <!--  -->
  <!-- <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/fesaille" target="_blank" rel="noopener" title="github" class="md-footer-social__link fa fa-github"></a>
    
  </div>

    </div>
  </div> -->
</footer>
      
    </div>
    
      <script src="../../../../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../../.."}})</script>
      
        <script src="../../../../_js/extra.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/js-sequence-diagrams/1.0.6/sequence-diagram-min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/treant-js/1.0/Treant.min.js"></script>
      
        <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
      
    
  </body>
</html>